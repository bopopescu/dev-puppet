# This file is managed by Puppet.

# Sudoers allows particular users to run various commands as
# the root user, without needing the root password.
#
# This file must be edited with the 'visudo' command.

# Host Aliases
# Host_Alias     FILESERVERS = fs1, fs2
# Host_Alias     MAILSERVERS = smtp, smtp2

# Command Aliases
# Networking
# Cmnd_Alias NETWORKING = /sbin/route, /sbin/ifconfig, /bin/ping, /sbin/dhclient, /usr/bin/net, /sbin/iptables, /usr/bin/rfcomm, /usr/bin/wvdial, /sbin/iwconfig, /sbin/mii-tool

# Installation and management of software
# Cmnd_Alias SOFTWARE = /bin/rpm, /usr/bin/up2date, /usr/bin/yum

# Services
# Cmnd_Alias SERVICES = /sbin/service, /sbin/chkconfig

# Storage
# Cmnd_Alias STORAGE = /sbin/fdisk, /sbin/sfdisk, /sbin/parted, /sbin/partprobe, /bin/mount, /bin/umount

# Delegating permissions
# Cmnd_Alias DELEGATING = /usr/sbin/visudo, /bin/chown, /bin/chmod, /bin/chgrp 

# Shells
Cmnd_Alias SHELLS = /bin/sh, /bin/bash, /sbin/nologin, /bin/tcsh, /bin/csh

# Impersonate users
Cmnd_Alias SU = /bin/su

# Defaults specification
# Disable "ssh hostname sudo <cmd>", because it will show the password in clear.
#         You have to run "ssh -t hostname sudo <cmd>".
# Defaults    requiretty

# Refuse to run if unable to disable echo on the tty. This setting should also
# be changed in order to be able to use sudo without a tty. See requiretty
# above.
Defaults   !visiblepw

# Preserving HOME has security implications since many programs use it when
# searching for configuration files. Note that HOME is already set when the the
# env_reset option is enabled, so this option is only effective for
# configurations where either env_reset is disabled or HOME is present in the
# env_keep list.
Defaults    always_set_home

Defaults    env_reset
Defaults    env_keep =  "COLORS DISPLAY HOSTNAME HISTSIZE INPUTRC KDEDIR LS_COLORS"
Defaults    env_keep += "MAIL PS1 PS2 QTDIR USERNAME LANG LC_ADDRESS LC_CTYPE"
Defaults    env_keep += "LC_COLLATE LC_IDENTIFICATION LC_MEASUREMENT LC_MESSAGES"
Defaults    env_keep += "LC_MONETARY LC_NAME LC_NUMERIC LC_PAPER LC_TELEPHONE"
Defaults    env_keep += "LC_TIME LC_ALL LANGUAGE LINGUAS _XKB_CHARSET XAUTHORITY"

# Adding HOME to env_keep may enable a user to run unrestricted commands via
# sudo.
# Defaults   env_keep += "HOME"
Defaults    secure_path = /sbin:/bin:/usr/sbin:/usr/bin


# Next comes the main part: which users can run what software on which machines
# (the sudoers file can be shared between multiple systems). Syntax:
#
# 	user	MACHINE=COMMANDS

# Allow root to run any commands anywhere 
root	ALL=(ALL) 	ALL

# Allows people in group wheel to run all commands
%wheel	ALL=(ALL)	NOPASSWD: ALL

# Allow admins in group 'sudo' to run commands but not invoke a shell
# or impersonate users
%sudo ALL = NOEXEC:ALL, !SHELLS, !SU

